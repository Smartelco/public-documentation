<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Document Processing System - Detailed High Level Flow</title>

    <!-- Primary Meta Tags -->
    <meta name="title" content="Document Processing System Flow">
    <meta name="description" content="Technical documentation for intelligent document processing system using Vision LLM, Rust and SurrealDB">

    <!-- Open Graph / Facebook / Telegram -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="🔍 Document Processing System Architecture">
    <meta property="og:description" content="Detailed technical flow for intelligent document classification & data extraction using Vision LLM, Rust and SurrealDB">
    <meta property="og:image" content="https://smartelco.github.io/public-documentation/TA/web/assets/images/flow-meta.png">

    <!-- For better Telegram preview -->
    <meta property="og:site_name" content="Technical Documentation">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">

    <!-- Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="🔍 Document Processing System Architecture">
    <meta name="twitter:description" content="Detailed technical flow for intelligent document classification & data extraction using Vision LLM, Rust and SurrealDB">
    <meta name="twitter:image" content="https://smartelco.github.io/public-documentation/TA/web/assets/images/flow-meta.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .flow-container {
            padding: 40px;
            background: #f8f9fa;
        }

        .flow-step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 40px;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            position: relative;
            transition: transform 0.3s ease;
        }

        .flow-step:hover {
            transform: translateY(-5px);
        }

        .step-number {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            margin-right: 25px;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 12px;
        }

        .step-description {
            color: #7f8c8d;
            line-height: 1.6;
            margin-bottom: 20px;
            font-size: 1.1em;
        }

        .mini-flow {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
        }

        .mini-flow h4 {
            color: #2c3e50;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .mini-flow-steps {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .mini-step {
            background: #667eea;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
        }

        .mini-arrow {
            color: #667eea;
            font-size: 1.2em;
            font-weight: bold;
        }

        .code-example {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
            margin: 15px 0;
        }

        .code-example .comment {
            color: #68d391;
        }

        .code-example .string {
            color: #fbb6ce;
        }

        .code-example .keyword {
            color: #90cdf4;
        }

        .input-output {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }

        .input-box, .output-box {
            padding: 15px;
            border-radius: 8px;
            font-size: 0.9em;
        }

        .input-box {
            color: #2c3e50;
            background: #fef5e7;
            border-left: 4px solid #f6ad55;
        }

        .output-box {
            color: #2c3e50;
            background: #f0fff4;
            border-left: 4px solid #68d391;
        }

        .input-box h5, .output-box h5 {
            margin-bottom: 8px;
            font-weight: bold;
        }

        .step-details {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .detail-tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .arrow {
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 15px solid #667eea;
        }

        .flow-step:last-child .arrow {
            display: none;
        }

        .decision-point {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
        }

        .decision-point .step-number {
            background: rgba(255,255,255,0.2);
        }

        .decision-point .detail-tag {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .decision-point .mini-flow {
            background: rgba(255,255,255,0.1);
            border-left-color: rgba(255,255,255,0.5);
        }

        .decision-point .mini-step {
            background: rgba(255,255,255,0.2);
        }

        .process-point {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
        }

        .process-point .step-number {
            background: rgba(255,255,255,0.2);
        }

        .process-point .detail-tag {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .process-point .mini-flow {
            background: rgba(255,255,255,0.1);
            border-left-color: rgba(255,255,255,0.5);
        }

        .process-point .mini-step {
            background: rgba(255,255,255,0.2);
        }

        .output-point {
            background: linear-gradient(135deg, #43e97b, #38f9d7);
            color: white;
        }

        .output-point .step-number {
            background: rgba(255,255,255,0.2);
        }

        .output-point .detail-tag {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .output-point .mini-flow {
            background: rgba(255,255,255,0.1);
            border-left-color: rgba(255,255,255,0.5);
        }

        .output-point .mini-step {
            background: rgba(255,255,255,0.2);
        }

        .prompt-example {
            background: #1a202c;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #4299e1;
        }

        .prompt-example h5 {
            color: #4299e1;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .flow-step {
                flex-direction: column;
                text-align: center;
            }

            .step-number {
                margin-right: 0;
                margin-bottom: 15px;
            }

            .header h1 {
                font-size: 2em;
            }

            .input-output {
                grid-template-columns: 1fr;
            }
        }

         .code-container {
            background-color: #1e1e1e;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        .code-example {
            color: #d4d4d4;
            font-family: 'Fira Code', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            white-space: pre;
            margin: 0;
        }

        /* Syntax highlighting colors */
        .comment {
            color: #6a9955;
            font-style: italic;
        }

        .keyword {
            color: #569cd6;
            font-weight: bold;
        }

        .function {
            color: #dcdcaa;
        }

        .type {
            color: #4ec9b0;
        }

        .string {
            color: #ce9178;
        }

        .number {
            color: #b5cea8;
        }

        .operator {
            color: #d4d4d4;
        }

        .bracket {
            color: #ffd700;
        }

        /* Alternative dark theme */
        .code-container.dark-theme {
            background-color: #0d1117;
        }

        .dark-theme .code-example {
            color: #c9d1d9;
        }

        .dark-theme .comment {
            color: #8b949e;
        }

        .dark-theme .keyword {
            color: #ff7b72;
        }

        .dark-theme .function {
            color: #d2a8ff;
        }

        .dark-theme .type {
            color: #79c0ff;
        }

        .dark-theme .string {
            color: #a5d6ff;
        }

        /* Light theme alternative */
        .code-container.light-theme {
            background-color: #ffffff;
            border: 1px solid #e1e4e8;
        }

        .light-theme .code-example {
            color: #24292e;
        }

        .light-theme .comment {
            color: #6a737d;
        }

        .light-theme .keyword {
            color: #d73a49;
        }

        .light-theme .function {
            color: #6f42c1;
        }

        .light-theme .type {
            color: #005cc5;
        }

        .light-theme .string {
            color: #032f62;
        }

        .theme-selector {
            margin-bottom: 20px;
        }

        .theme-button {
            background-color: #007acc;
            color: white;
            border: none;
            padding: 8px 16px;
            margin-right: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .theme-button:hover {
            background-color: #005a9e;
        }

        .theme-button.active {
            background-color: #28a745;
        }

         /* Mobile Responsive Updates */
    @media (max-width: 768px) {
        body {
            padding: 10px;
        }

        .container {
            width: 100%;
            margin: 0;
            border-radius: 10px;
        }

        .header {
            padding: 20px 15px;
        }

        .header h1 {
            font-size: 1.8em;
        }

        .header p {
            font-size: 1em;
        }

        .flow-container {
            padding: 20px 15px;
        }

        .flow-step {
            flex-direction: column;
            padding: 20px 15px;
            margin-bottom: 30px;
        }

        .step-number {
            margin: 0 auto 15px auto;
            width: 50px;
            height: 50px;
            font-size: 1.2em;
        }

        .step-content {
            text-align: center;
        }

        .step-title {
            font-size: 1.3em;
        }

        .step-description {
            font-size: 1em;
        }

        .mini-flow {
            padding: 15px;
        }

        .mini-flow-steps {
            justify-content: center;
        }

        .code-example {
            font-size: 0.8em;
            padding: 10px;
            overflow-x: auto;
            white-space: pre-wrap;
        }

        .input-output {
            grid-template-columns: 1fr;
            gap: 10px;
        }

        .step-details {
            justify-content: center;
        }

        /* Technology Stack section */
        [style*="grid-template-columns"] {
            grid-template-columns: 1fr !important;
        }

        /* Prompt sections */
        .prompt-example {
            padding: 15px;
            font-size: 0.85em;
        }

        /* Code container adjustments */
        .code-container {
            padding: 15px;
            margin: 15px 0;
        }

        .code-example {
            font-size: 12px;
        }

        /* Theme buttons */
        .theme-button {
            padding: 6px 12px;
            font-size: 11px;
            margin-bottom: 5px;
        }

        /* Arrow adjustments */
        .arrow {
            border-left-width: 10px;
            border-right-width: 10px;
            border-top-width: 10px;
        }
    }

    /* Small mobile devices */
    @media (max-width: 480px) {
        .header h1 {
            font-size: 1.5em;
        }

        .step-title {
            font-size: 1.2em;
        }

        .mini-flow-steps {
            flex-direction: column;
            align-items: stretch;
        }

        .mini-step {
            text-align: center;
            margin: 5px 0;
        }

        .mini-arrow {
            transform: rotate(90deg);
            margin: 5px 0;
        }

        .detail-tag {
            width: 100%;
            text-align: center;
            margin: 5px 0;
        }
    }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔍 Document Processing System</h1>
            <p>Detailed High-Level Flow - Intelligent Document Classification & Data Extraction</p>
        </div>

        <div class="flow-container">
            <!-- Step 1: Input -->
            <div class="flow-step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <div class="step-title">📷 Document Input</div>
                    <div class="step-description">
                        User mengunggah gambar dokumen ke sistem untuk diproses
                    </div>
                    
                    <div class="mini-flow">
                        <h4>🔄 Mini Flow:</h4>
                        <div class="mini-flow-steps">
                            <div class="mini-step">HTTP Upload</div>
                            <div class="mini-arrow">→</div>
                            <div class="mini-step">File Validation</div>
                            <div class="mini-arrow">→</div>
                            <div class="mini-step">Store Temporary</div>
                        </div>
                    </div>

                    <div class="input-output">
                        <div class="input-box">
                            <h5>📥 Input Example:</h5>
                            <code>
                                POST /api/process-document<br>
                                Content-Type: multipart/form-data<br>
                                File: incident_report.png (2.3MB)
                            </code>
                        </div>
                        <div class="output-box">
                            <h5>📤 Output Example:</h5>
                            <code>
                                {<br>
                                &nbsp;&nbsp;"file_id": "temp_001",<br>
                                &nbsp;&nbsp;"status": "uploaded",<br>
                                &nbsp;&nbsp;"size": "2.3MB"<br>
                                }
                            </code>
                        </div>
                    </div>

                    <div class="step-details">
                        <span class="detail-tag">Rust Axum Handler</span>
                        <span class="detail-tag">File Size Validation</span>
                        <span class="detail-tag">Format Check</span>
                    </div>
                </div>
                <div class="arrow"></div>
            </div>

            <!-- Step 2: Preprocessing -->
            <div class="flow-step process-point">
                <div class="step-number">2</div>
                <div class="step-content">
                    <div class="step-title">🔧 Image Preprocessing & Text Extraction</div>
                    <div class="step-description">
                        Optimalisasi gambar dan ekstraksi teks menggunakan Vision LLM
                    </div>
                    
                    <div class="mini-flow">
                        <h4>🔄 Mini Flow:</h4>
                        <div class="mini-flow-steps">
                            <div class="mini-step">Image Enhancement</div>
                            <div class="mini-arrow">→</div>
                            <div class="mini-step">Vision LLM OCR</div>
                            <div class="mini-arrow">→</div>
                            <div class="mini-step">Text Extraction</div>
                        </div>
                    </div>

                    <div class="code-example">
<span class="comment">// Rust preprocessing with Vision LLM as OCR</span>
<span class="keyword">async fn</span> preprocess_image(image_path: &str) -> Result&lt;ProcessedImage&gt; {
    <span class="comment">// Enhance image quality</span>
    <span class="keyword">let</span> enhanced = enhance_image_quality(image_path).await?;
    
    <span class="comment">// Use Vision LLM to extract text (like OCR)</span>
    <span class="keyword">let</span> ocr_prompt = <span class="string">"Extract all visible text from this image. <br> Return only the text content, preserving the layout and structure as much as possible."</span>;
    
    <span class="keyword">let</span> extracted_text = vision_llm_extract_text(&enhanced, ocr_prompt).await?;
    <span class="keyword">let</span> cleaned_text = clean_and_normalize_text(&extracted_text);
    
    Ok(ProcessedImage {
        enhanced_image: enhanced,
        extracted_text: cleaned_text,
        text_confidence: calculate_extraction_confidence(&extracted_text),
        image_metadata: get_image_metadata(&enhanced)?
    })
}
                    </div>

                    <div class="input-output">
                        <div class="input-box">
                            <h5>📥 Input:</h5>
                            Raw image file dari step 1
                        </div>
                        <div class="output-box">
                            <h5>📤 Output:</h5>
                            <code>
                                ProcessedImage {<br>
                                &nbsp;&nbsp;enhanced_image: "enhanced.png",<br>
                                &nbsp;&nbsp;extracted_text: "INC32832025 GANGGUAN RBS POTS...",<br>
                                &nbsp;&nbsp;text_confidence: 0.92,<br>
                                &nbsp;&nbsp;image_metadata: {...}<br>
                                }
                            </code>
                        </div>
                    </div>

                    <div class="step-details">
                        <span class="detail-tag">Image Enhancement</span>
                        <span class="detail-tag">Vision LLM OCR</span>
                        <span class="detail-tag">Text Extraction</span>
                        <span class="detail-tag">Text Cleaning</span>
                    </div>
                </div>
                <div class="arrow"></div>
            </div>

            <!-- Step 3: Classification -->
            <div class="flow-step decision-point">
                <div class="step-number">3</div>
                <div class="step-content">
                    <div class="step-title">🎯 Document Classification</div>
                    <div class="step-description">
                        Identifikasi jenis dokumen menggunakan hybrid approach (keywords + LLM)
                    </div>
                    
                    <div class="mini-flow">
                        <h4>🔄 Mini Flow:</h4>
                        <div class="mini-flow-steps">
                            <div class="mini-step">Keyword Scoring</div>
                            <div class="mini-arrow">→</div>
                            <div class="mini-step">LLM Classification</div>
                            <div class="mini-arrow">→</div>
                            <div class="mini-step">Confidence Merge</div>
                        </div>
                    </div>

                    <div class="prompt-example">
                        <h5>🤖 Classification Prompt:</h5>
                        <div style="white-space: pre-wrap;">Analyze this document image and classify it into one of these categories:

1. **customer_data** - Form dengan field: nama pelanggan, alamat, kontak
   Key indicators: "NAMA PELANGGAN", "ALAMAT", "KONTAK", customer info table

2. **service_report** - Form dengan field: reported by, contact info, BUD, customer segment  
   Key indicators: "Reported By", "Contact Name", "Contact Phone", "BUD", dropdown menus

3. **incident_report** - Form dengan field: incident ID, gangguan, TTR, status workflow
   Key indicators: "INC[numbers]", "GANGGUAN", "RBS", "POTS", status buttons

Look for these visual clues:
- Form layout and structure
- Field labels and text
- Button/dropdown patterns
- Table headers

Respond with ONLY the category name: customer_data, service_report, or incident_report</div>
                    </div>

                    <div class="code-example">
<span class="comment">// Rust hybrid classification with extracted text + image</span>
<span class="keyword">async fn</span> classify_document(processed_image: &ProcessedImage) -> ClassificationResult {
    <span class="comment">// Method 1: Keyword scoring from extracted text</span>
    <span class="keyword">let</span> keyword_scores = calculate_keyword_scores(&processed_image.extracted_text);
    
    <span class="comment">// Method 2: Vision LLM classification (if keyword confidence is low)</span>
    <span class="keyword">let</span> classification_result = <span class="keyword">if</span> keyword_scores.max_confidence < 0.7 {
        vision_llm_classify_image(&processed_image.enhanced_image, CLASSIFICATION_PROMPT).await?
    } <span class="keyword">else</span> {
        keyword_scores.best_match.clone()
    };
    
    <span class="comment">// Combine and validate results</span>
    <span class="keyword">let</span> final_confidence = calculate_combined_confidence(
        &keyword_scores, 
        &classification_result,
        processed_image.text_confidence
    );
    
    ClassificationResult {
        document_type: classification_result.document_type,
        confidence: final_confidence,
        method: <span class="string">"hybrid_smart"</span>,
        keyword_backup: keyword_scores.max_confidence
    }
}
                    </div>

                    <div class="input-output">
                        <div class="input-box">
                            <h5>📥 Input:</h5>
                            <code>
                                ProcessedImage {<br>
                                &nbsp;&nbsp;extracted_text: "INC32832025 GANGGUAN...",<br>
                                &nbsp;&nbsp;enhanced_image: "path.png"<br>
                                }
                            </code>
                        </div>
                        <div class="output-box">
                            <h5>📤 Output:</h5>
                            <code>
                                ClassificationResult {<br>
                                &nbsp;&nbsp;document_type: "incident_report",<br>
                                &nbsp;&nbsp;confidence: 0.94,<br>
                                &nbsp;&nbsp;method: "hybrid_smart",<br>
                                &nbsp;&nbsp;keyword_backup: 0.89<br>
                                }
                            </code>
                        </div>
                    </div>

                    <div class="step-details">
                        <span class="detail-tag">Keyword Matching</span>
                        <span class="detail-tag">Vision LLM</span>
                        <span class="detail-tag">Confidence Scoring</span>
                    </div>
                </div>
                <div class="arrow"></div>
            </div>

            <!-- Step 4: Template Selection -->
            <div class="flow-step">
                <div class="step-number">4</div>
                <div class="step-content">
                    <div class="step-title">📋 Template Selection</div>
                    <div class="step-description">
                        Pilih template extraction berdasarkan hasil klasifikasi dari SurrealDB
                    </div>
                    
                    <div class="mini-flow">
                        <h4>🔄 Mini Flow:</h4>
                        <div class="mini-flow-steps">
                            <div class="mini-step">Query SurrealDB</div>
                            <div class="mini-arrow">→</div>
                            <div class="mini-step">Get Template</div>
                            <div class="mini-arrow">→</div>
                            <div class="mini-step">Load Schema</div>
                        </div>
                    </div>

                    <div class="code-example">
<span class="comment">// SurrealDB template query</span>
<span class="keyword">async fn</span> get_template(db: &Surreal&lt;Client&gt;, doc_type: &str) -> Result&lt;Template&gt; {
    <span class="keyword">let</span> query = <span class="string">"SELECT * FROM document_template WHERE type = $doc_type LIMIT 1"</span>;
    <span class="keyword">let</span> mut result = db.query(query)
        .bind((<span class="string">"doc_type"</span>, doc_type))
        .await?;
    
    <span class="keyword">let</span> template: Option&lt;Template&gt; = result.take(0)?;
    template.ok_or_else(|| anyhow!(<span class="string">"Template not found for {}"</span>, doc_type))
}
                    </div>

                    <div class="input-output">
                        <div class="input-box">
                            <h5>📥 Input:</h5>
                            <code>
                                document_type: "incident_report"
                            </code>
                        </div>
                        <div class="output-box">
                            <h5>📤 Output:</h5>
                            <code>
                                Template {<br>
                                &nbsp;&nbsp;name: "incident_report_form",<br>
                                &nbsp;&nbsp;schema: {...},<br>
                                &nbsp;&nbsp;extraction_prompt: "...",<br>
                                &nbsp;&nbsp;version: "1.2"<br>
                                }
                            </code>
                        </div>
                    </div>

                    <div class="step-details">
                        <span class="detail-tag">SurrealDB Query</span>
                        <span class="detail-tag">Template Caching</span>
                        <span class="detail-tag">Schema Loading</span>
                    </div>
                </div>
                <div class="arrow"></div>
            </div>

            <!-- Step 5: Data Extraction -->
            <div class="flow-step process-point">
                <div class="step-number">5</div>
                <div class="step-content">
                    <div class="step-title">⚡ Data Extraction</div>
                    <div class="step-description">
                        Ekstrak structured data dari gambar menggunakan template-specific prompt
                    </div>
                    
                    <div class="mini-flow">
                        <h4>🔄 Mini Flow:</h4>
                        <div class="mini-flow-steps">
                            <div class="mini-step">Build Prompt</div>
                            <div class="mini-arrow">→</div>
                            <div class="mini-step">Vision LLM Call</div>
                            <div class="mini-arrow">→</div>
                            <div class="mini-step">Parse JSON</div>
                        </div>
                    </div>

                    <div class="prompt-example">
                        <h5>🤖 Extraction Prompt untuk Incident Report:</h5>
                        <div style="white-space: pre-wrap;">Extract the following fields from this incident report image:

**Required Fields:**
- incident_id: Look for pattern "INC" followed by numbers (e.g., INC32832025)
- description: Main problem description or fault description
- location: Full address or location mentioned

**Optional Fields:**  
- reported_date: Date when incident was reported
- priority: Priority level (Low/Medium/High/Critical)
- status: Current status from workflow buttons
- owner: Assigned owner or technician
- owner_group: Team or group responsible

**Output Format:**
Return ONLY valid JSON matching this schema:
{
  "incident_id": "string",
  "description": "string", 
  "location": "string",
  "reported_date": "ISO date string or null",
  "priority": "string or null",
  "status": "string or null",
  "owner": "string or null", 
  "owner_group": "string or null"
}

Focus on accuracy. If field is not clearly visible, use null.</div>
                    </div>

                    <div class="code-example">
<span class="comment">// Rust extraction logic</span>
<span class="keyword">async fn</span> extract_data(image_path: &str, template: &Template) -> Result&lt;ExtractedData&gt; {
    <span class="keyword">let</span> prompt = build_extraction_prompt(template);
    <span class="keyword">let</span> llm_response = vision_llm.process_image(image_path, &prompt).await?;
    
    <span class="comment">// Parse and validate JSON</span>
    <span class="keyword">let</span> extracted: serde_json::Value = serde_json::from_str(&llm_response)?;
    <span class="keyword">let</span> validated = validate_against_schema(&extracted, &template.schema)?;
    
    Ok(ExtractedData {
        data: validated,
        confidence: calculate_extraction_confidence(&llm_response),
        template_version: template.version.clone()
    })
}
                    </div>

                    <div class="input-output">
                        <div class="input-box">
                            <h5>📥 Input:</h5>
                            <code>
                                Image: incident_report.png<br>
                                Template: incident_report_form<br>
                                Prompt: extraction_prompt
                            </code>
                        </div>
                        <div class="output-box">
                            <h5>📤 Output:</h5>
                            <code>
                                {<br>
                                &nbsp;&nbsp;"incident_id": "INC32832025",<br>
                                &nbsp;&nbsp;"description": "GANGGUAN RBG POTS",<br>
                                &nbsp;&nbsp;"location": "SEMARANG UTARA",<br>
                                &nbsp;&nbsp;"priority": "Low",<br>
                                &nbsp;&nbsp;"status": "New"<br>
                                }
                            </code>
                        </div>
                    </div>

                    <div class="step-details">
                        <span class="detail-tag">Template-based Prompting</span>
                        <span class="detail-tag">Vision LLM Processing</span>
                        <span class="detail-tag">JSON Parsing</span>
                    </div>
                </div>
                <div class="arrow"></div>
            </div>

            <!-- Step 6: Validation -->
            <div class="flow-step decision-point">
                <div class="step-number">6</div>
                <div class="step-content">
                    <div class="step-title">✅ Data Validation</div>
                    <div class="step-description">
                        Validasi data yang diekstrak terhadap schema dan business rules
                    </div>
                    
                    <div class="mini-flow">
                        <h4>🔄 Mini Flow:</h4>
                        <div class="mini-flow-steps">
                            <div class="mini-step">Schema Check</div>
                            <div class="mini-arrow">→</div>
                            <div class="mini-step">Pattern Match</div>
                            <div class="mini-arrow">→</div>
                            <div class="mini-step">Business Rules</div>
                        </div>
                    </div>

                    <div class="code-example">
<span class="comment">// Rust validation logic</span>
<span class="keyword">async fn</span> validate_extracted_data(data: &ExtractedData, template: &Template) -> ValidationResult {
    <span class="keyword">let</span> <span class="keyword">mut</span> errors = Vec::new();
    
    <span class="comment">// Required field validation</span>
    <span class="keyword">for</span> (field, config) <span class="keyword">in</span> &template.schema.required_fields {
        <span class="keyword">if</span> config.required && data.get(field).is_none() {
            errors.push(format!(<span class="string">"Required field '{}' is missing"</span>, field));
        }
    }
    
    <span class="comment">// Pattern validation</span>
    <span class="keyword">if</span> <span class="keyword">let</span> Some(incident_id) = data.get(<span class="string">"incident_id"</span>) {
        <span class="keyword">if</span> !Regex::new(r<span class="string">"^INC\d+$"</span>).unwrap().is_match(incident_id) {
            errors.push(<span class="string">"Incident ID must match pattern INC[numbers]"</span>.into());
        }
    }
    
    ValidationResult {
        is_valid: errors.is_empty(),
        errors,
        confidence: calculate_validation_confidence(&data, &template)
    }
}
                    </div>

                    <div class="input-output">
                        <div class="input-box">
                            <h5>📥 Input:</h5>
                            <code>
                                ExtractedData + Schema Rules
                            </code>
                        </div>
                        <div class="output-box">
                            <h5>📤 Output:</h5>
                            <code>
                                ValidationResult {<br>
                                &nbsp;&nbsp;is_valid: true,<br>
                                &nbsp;&nbsp;errors: [],<br>
                                &nbsp;&nbsp;confidence: 0.95<br>
                                }
                            </code>
                        </div>
                    </div>

                    <div class="step-details">
                        <span class="detail-tag">Schema Validation</span>
                        <span class="detail-tag">Pattern Matching</span>
                        <span class="detail-tag">Business Rules</span>
                    </div>
                </div>
                <div class="arrow"></div>
            </div>

            <!-- Step 7: Historical Storage -->
            <div class="flow-step process-point">
                <div class="step-number">7</div>
                <div class="step-content">
                    <div class="step-title">🗄️ Historical Data Storage</div>
                    <div class="step-description">
                        Simpan structured output ke SurrealDB sebagai historical data
                    </div>
                    
                    <div class="mini-flow">
                        <h4>🔄 Mini Flow:</h4>
                        <div class="mini-flow-steps">
                            <div class="mini-step">Create Record</div>
                            <div class="mini-arrow">→</div>
                            <div class="mini-step">SurrealDB Insert</div>
                            <div class="mini-arrow">→</div>
                            <div class="mini-step">Generate ID</div>
                        </div>
                    </div>

                    <div class="code-example">
<span class="comment">// SurrealDB historical storage</span>
<span class="keyword">async fn</span> store_processing_result(
    db: &Surreal&lt;Client&gt;,
    result: &ProcessingResult
) -> Result&lt;String&gt; {
    <span class="keyword">let</span> historical_record = HistoricalRecord {
        id: generate_id(),
        document_type: result.document_type.clone(),
        extracted_data: result.extracted_data.clone(),
        confidence_score: result.confidence,
        template_used: result.template_id.clone(),
        processing_time: result.processing_time,
        validation_status: result.validation.is_valid,
        processed_at: Utc::now(),
        image_metadata: result.image_metadata.clone(),
    };
    
    <span class="keyword">let</span> record_id: String = db
        .create(<span class="string">"document_processed"</span>)
        .content(historical_record)
        .await?;
    
    Ok(record_id)
}
                    </div>

                    <div class="input-output">
                        <div class="input-box">
                            <h5>📥 Input:</h5>
                            <code>
                                ProcessingResult {<br>
                                &nbsp;&nbsp;document_type: "incident_report",<br>
                                &nbsp;&nbsp;extracted_data: {...},<br>
                                &nbsp;&nbsp;confidence: 0.92<br>
                                }
                            </code>
                        </div>
                        <div class="output-box">
                            <h5>📤 Output:</h5>
                            <code>
                                {<br>
                                &nbsp;&nbsp;"historical_id": "document_processed:01HXX...",<br>
                                &nbsp;&nbsp;"stored_at": "2025-05-26T14:08:03Z",<br>
                                &nbsp;&nbsp;"status": "stored"<br>
                                }
                            </code>
                        </div>
                    </div>

                    <div class="step-details">
                        <span class="detail-tag">SurrealDB Insert</span>
                        <span class="detail-tag">Audit Trail</span>
                        <span class="detail-tag">Metadata Storage</span>
                        <span class="detail-tag">Processing Analytics</span>
                    </div>
                </div>
                <div class="arrow"></div>
            </div>

            <!-- Step 8: Output -->
            <div class="flow-step output-point">
                <div class="step-number">8</div>
                <div class="step-content">
                    <div class="step-title">📊 Structured Output & Response</div>
                    <div class="step-description">
                        Return structured data ke user dengan metadata lengkap dan historical reference
                    </div>
                    
                    <div class="mini-flow">
                        <h4>🔄 Mini Flow:</h4>
                        <div class="mini-flow-steps">
                            <div class="mini-step">Build Response</div>
                            <div class="mini-arrow">→</div>
                            <div class="mini-step">Add Metadata</div>
                            <div class="mini-arrow">→</div>
                            <div class="mini-step">JSON Return</div>
                        </div>
                    </div>

                    <div class="code-example">
<span class="comment">// Final response builder</span>
<span class="keyword">async fn</span> build_final_response(
    result: ProcessingResult,
    historical_id: String
) -> ApiResponse {
    ApiResponse {
        success: <span class="keyword">true</span>,
        document_type: result.document_type,
        confidence: result.confidence,
        extracted_data: result.extracted_data,
        historical_id,
        processing_metadata: ProcessingMetadata {
            template_version: result.template_version,
            processing_time: result.processing_time,
            validation_errors: result.validation.errors,
            image_size: result.image_metadata.size,
            ocr_confidence: result.ocr_confidence,
        },
        timestamp: Utc::now(),
    }
}
                    </div>

                    <div class="input-output">
                        <div class="input-box">
                            <h5>📥 Internal Processing Result:</h5>
                            <code>
                                ProcessingResult + historical_id
                            </code>
                        </div>
                        <div class="output-box">
                            <h5>📤 Final API Response:</h5>
                            <code>
                                {<br>
                                &nbsp;&nbsp;"success": true,<br>
                                &nbsp;&nbsp;"document_type": "incident_report",<br>
                                &nbsp;&nbsp;"confidence": 0.92,<br>
                                &nbsp;&nbsp;"extracted_data": {<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;"incident_id": "INC32832025",<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;"description": "GANGGUAN RBG POTS",<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;"location": "SEMARANG UTARA"<br>
                                &nbsp;&nbsp;},<br>
                                &nbsp;&nbsp;"historical_id": "document_processed:01HXX...",<br>
                                &nbsp;&nbsp;"processing_metadata": {<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;"template_version": "1.2",<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;"processing_time": 1.8,<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;"validation_errors": []<br>
                                &nbsp;&nbsp;}<br>
                                }
                            </code>
                        </div>
                    </div>

                    <div class="step-details">
                        <span class="detail-tag">JSON Response</span>
                        <span class="detail-tag">Historical Reference</span>
                        <span class="detail-tag">Processing Metadata</span>
                        <span class="detail-tag">Error Handling</span>
                    </div>
                </div>
            </div>

            <!-- Technology Stack -->
            <div style="margin-top: 40px; padding: 30px; background: white; border-radius: 15px; border-left: 5px solid #667eea;">
                <h3 style="color: #2c3e50; margin-bottom: 20px; font-size: 1.5em;">🛠️ Technology Stack & Implementation Details</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div style="padding: 15px; background: #f8f9fa; border-radius: 10px; border-left: 3px solid #667eea;">
                        <h4 style="color: #2c3e50; margin-bottom: 8px;">Backend Language</h4>
                        <p style="color: #7f8c8d; font-size: 0.9em;">Rust untuk high-performance processing, memory safety, dan concurrent operations dengan SurrealDB integration</p>
                        <div class="code-example" style="margin-top: 10px; font-size: 0.8em;">
<span class="comment">// Key Rust crates</span>
surrealdb = <span class="string">"1.0"</span>
axum = <span class="string">"0.7"</span>
tokio = <span class="string">"1.0"</span>
serde = <span class="string">"1.0"</span>
                        </div>
                    </div>
                    <div style="padding: 15px; background: #f8f9fa; border-radius: 10px; border-left: 3px solid #667eea;">
                        <h4 style="color: #2c3e50; margin-bottom: 8px;">SurrealDB</h4>
                        <p style="color: #7f8c8d; font-size: 0.9em;">Multi-model database untuk template storage, historical data archive, real-time analytics, dan document relationship tracking</p>
                        <div class="code-example" style="margin-top: 10px; font-size: 0.8em;">
<span class="comment">// SurrealDB features</span>
- Multi-model (Document + Graph + Time-series)
- Real-time subscriptions
- Schema flexibility
- Built-in analytics
                        </div>
                    </div>
                    <div style="padding: 15px; background: #f8f9fa; border-radius: 10px; border-left: 3px solid #667eea;">
                        <h4 style="color: #2c3e50; margin-bottom: 8px;">Vision LLM</h4>
                        <p style="color: #7f8c8d; font-size: 0.9em;">OpenAI GPT-4V, Claude 3.5 Sonnet, atau InterViL3-8B-AWQ untuk vision processing dan structured data extraction</p>
                        <div class="code-example" style="margin-top: 10px; font-size: 0.8em;">
<span class="comment">// LLM integration</span>
<span class="keyword">async fn</span> call_vision_llm(
    image: &str, 
    prompt: &str
) -> Result&lt;String&gt;
                        </div>
                    </div>
                    <div style="padding: 15px; background: #f8f9fa; border-radius: 10px; border-left: 3px solid #667eea;">
                        <h4 style="color: #2c3e50; margin-bottom: 8px;">API Layer</h4>
                        <p style="color: #7f8c8d; font-size: 0.9em;">Rust Axum framework untuk high-performance REST API dengan async operations dan robust error handling</p>
                        <div class="code-example" style="margin-top: 10px; font-size: 0.8em;">
<span class="comment">// Axum route example</span>
<span class="keyword">async fn</span> process_document(
    multipart: Multipart
) -> Json&lt;ApiResponse&gt;
                        </div>
                    </div>
                    <div style="padding: 15px; background: #f8f9fa; border-radius: 10px; border-left: 3px solid #667eea;">
                        <h4 style="color: #2c3e50; margin-bottom: 8px;">Template Management</h4>
                        <p style="color: #7f8c8d; font-size: 0.9em;">Dynamic template system dengan versioning, A/B testing, dan real-time performance monitoring</p>
                        <div class="code-example" style="margin-top: 10px; font-size: 0.8em;">
<span class="comment">// Template structure</span>
<span class="keyword">struct</span> Template {
    name: String,
    schema: serde_json::Value,
    extraction_prompt: String,
    version: String
}
                        </div>
                    </div>
                    <div style="padding: 15px; background: #f8f9fa; border-radius: 10px; border-left: 3px solid #667eea;">
                        <h4 style="color: #2c3e50; margin-bottom: 8px;">Classification Engine</h4>
                        <p style="color: #7f8c8d; font-size: 0.9em;">Hybrid approach menggunakan keyword matching, pattern recognition, dan LLM-based classification dengan confidence scoring</p>
                        <div class="code-example" style="margin-top: 10px; font-size: 0.8em;">
<span class="comment">// Classification logic</span>
<span class="keyword">fn</span> hybrid_classify(
    keywords: f64,
    llm_score: f64
) -> ClassificationResult
                        </div>
                    </div>
                </div>
            </div>

            <!-- Key Prompts Section -->
            <div style="margin-top: 40px; padding: 30px; background: #1a202c; color: #e2e8f0; border-radius: 15px;">
                <h3 style="color: #4299e1; margin-bottom: 20px; font-size: 1.5em;">🎯 Key Prompts untuk Engineer Implementation</h3>
                
                <div style="margin-bottom: 30px;">
                    <h4 style="color: #68d391; margin-bottom: 15px;">1. Universal Classification Prompt</h4>
                    <div style="background: #2d3748; padding: 20px; border-radius: 10px; border-left: 4px solid #4299e1;">
                        <div style="white-space: pre-wrap; font-family: 'Courier New', monospace; font-size: 0.9em;">You are a document classifier. Analyze this image and classify it into one of these categories:

**customer_data**: Form containing customer information
- Visual indicators: Tables with personal data, "NAMA PELANGGAN", "ALAMAT", "KONTAK" labels
- Layout: Simple table structure with customer details

**service_report**: Service ticket or report form  
- Visual indicators: "Reported By", "Contact Name", form fields, dropdown menus
- Layout: Structured form with contact information and service details

**incident_report**: Technical incident or fault report
- Visual indicators: "INC" + numbers, "GANGGUAN", status workflow buttons, technical terms
- Layout: Complex form with incident details and status tracking

Return ONLY the category name: customer_data, service_report, or incident_report</div>
                    </div>
                </div>

                <div style="margin-bottom: 30px;">
                    <h4 style="color: #68d391; margin-bottom: 15px;">2. Data Extraction Prompt Template</h4>
                    <div style="background: #2d3748; padding: 20px; border-radius: 10px; border-left: 4px solid #4299e1;">
                        <div style="white-space: pre-wrap; font-family: 'Courier New', monospace; font-size: 0.9em;">Extract structured data from this {DOCUMENT_TYPE} image:

**Required Fields:**
{REQUIRED_FIELDS_LIST}

**Optional Fields:**  
{OPTIONAL_FIELDS_LIST}

**Instructions:**
1. Look carefully at all visible text and form fields
2. Extract exact values, don't interpret or modify
3. If a field is not clearly visible, use null
4. Pay attention to field labels and context

**Output Format:**
Return ONLY valid JSON matching this exact schema:
{JSON_SCHEMA}

Focus on accuracy over completeness.</div>
                    </div>
                </div>

                <div>
                    <h4 style="color: #68d391; margin-bottom: 15px;">3. Confidence Assessment Prompt</h4>
                    <div style="background: #2d3748; padding: 20px; border-radius: 10px; border-left: 4px solid #4299e1;">
                        <div style="white-space: pre-wrap; font-family: 'Courier New', monospace; font-size: 0.9em;">Rate your confidence in the extracted data on a scale of 0.0 to 1.0:

**Factors to consider:**
- Image quality and text clarity
- Completeness of visible information  
- Certainty of field identification
- Presence of required vs optional fields

**Confidence Scale:**
- 0.9-1.0: Very confident, all key fields clearly visible
- 0.7-0.9: Confident, most fields identifiable
- 0.5-0.7: Moderate, some uncertainty in extraction
- 0.3-0.5: Low confidence, poor image quality or unclear fields
- 0.0-0.3: Very low confidence, minimal extractable data

Return confidence score as a decimal number.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Add smooth scroll animation when page loads
        document.addEventListener('DOMContentLoaded', function() {
            const steps = document.querySelectorAll('.flow-step');
            steps.forEach((step, index) => {
                step.style.opacity = '0';
                step.style.transform = 'translateY(30px)';
                
                setTimeout(() => {
                    step.style.transition = 'all 0.6s ease';
                    step.style.opacity = '1';
                    step.style.transform = 'translateY(0)';
                }, index * 200);
            });
        });

        // Add hover effects
        document.querySelectorAll('.flow-step').forEach(step => {
            step.addEventListener('mouseenter', function() {
                this.style.boxShadow = '0 15px 30px rgba(0,0,0,0.15)';
            });
            
            step.addEventListener('mouseleave', function() {
                this.style.boxShadow = '0 5px 15px rgba(0,0,0,0.08)';
            });
        });

        // Add copy functionality for code examples
        document.querySelectorAll('.code-example, .prompt-example').forEach(element => {
            element.style.position = 'relative';
            element.style.cursor = 'pointer';
            
            element.addEventListener('click', function() {
                const text = this.innerText;
                navigator.clipboard.writeText(text).then(() => {
                    // Visual feedback
                    const originalBg = this.style.backgroundColor;
                    this.style.backgroundColor = '#2d5a2d';
                    setTimeout(() => {
                        this.style.backgroundColor = originalBg;
                    }, 200);
                });
            });
        });
    </script>
</body>
</html>